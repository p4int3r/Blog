# SQL注入实用手册

## SQL注入常用Payload

**SQL语句：**`select * from users where username = '$payload' and password = 'password'`

**Payload：**
    
    1. payload'--(空格) 
    2. ' or 1=1--(空格)
    3. payload' or 'a'='a
    4. '    # 观察是否会造成错误，或者结果是否与原始结果不同

**SQL语句：**`insert into users (username, password, ID) values ('$payload', 'password', 1)`

**Payload：**

    1. payload', 'password', 1)--(空格)

> 可以在values子句中持续增加一个新的字段，猜测insert语句需要提交的参数个数。大多数数据库都会隐式地将一个整数转换为一个字符串。

    payload')--(空格)
    payload', 1)--(空格)
    payload', 1, 1)--(空格)

## 查明SQL注入漏洞

### 注入字符串数据

**渗透测试步骤：**

1. 提交一个单引号作为目标查询的数据。观察是否会造成错误，或结果是否与原始结果不同。

2. 如果发现错误或其他异常行为，同时提交两个单引号，看会出现什么情况。数据库使用两个单引号作为转义序列，表示一个原义单引号，这个序列会被解释成引用字符串中的数据，而不是结束字符串的终止符。如果这个输入导致错误或异常行为消失，则应用程序可能存在SQL注入攻击。

3. 为进一步核实漏洞是否存在，可以使用SQL连接符建立一个等同于“良性”输入的字符串。如果应用程序以与处理对应的“良性”输入相同的方式处理专门设计的输入，那么它很可能存在SQL注入。例如，注入以下实例构建等同于foo的输入：
    
        Oracle：' || 'foo
        MS-SQL：'+'foo
        MySQL：'(空格)'foo

> 可以通过在特定的参数中提交SQL通配符%来确定应用程序是否与后端数据库交互。

### 注入数字数据

**渗透测试步骤：**

1. 尝试输入一个结果等于原始数字值的简单数学表达式。例如，如果原始值为2，尝试提交1+1或者3-1。如果应用程序做出相同的响应，则表示它易于受到攻击。

2. 如果证实被修改的数据会对应用程序的行为造成明显影响，则前面的描述的测试方法最为可靠。如果在上述的数字化参数中插入任意输入，但是应用程序的行为却没有发生改变，那么前面的检测方法就无法发现漏洞。

3. 如第一个测试方法取得成功，就可以利用更加复杂的、使用特殊SQL关键字和语法的表达式进一步获得与漏洞有关的证据。例如，以下表达式等于2：

        67-ASCII('A')

4. 如果单引号被过滤掉，那前面的测试方法就没有作用。但是，在必要时，数据库会隐含地将数字数据转为字符串数据。例如，因为字符1的ASCII值为49，在SQL中，以下表达式等于2：

        51-ASCII(1)

> 在探查SQL注入过程中，注意对某些特殊字符进行恰当的编码，如：

    & = (空格) + ;

## 附录：

1. MySQL注释字符：
    
    --(空格) 或者 #