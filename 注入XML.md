# 注入XML解释器

## 注入XML外部实体

如果遇到包含XML格式数据时，应当检查是否存在外部实体（XXE）注入漏洞。

**Payload：**

    <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///windows/win.ini"> ]>
    <Search><SearchTerm>&xxe;</SearchTerm></Search>

通过这种技巧可以实施以下攻击：

(1) 可以将应用程序作为代理服务器使用，从应用程序能够访问的任何Web服务器上检查敏感内容。

(2) 可以利用后端Web应用程序中的漏洞，只要这些漏洞可以通过URL加以利用。

(3) 攻击者可以通过攻击大量IP地址和端口号，对后端系统上的开放端口进行测试。

如果应用程序检索外部实体，但不在响应中返回该实体，则攻击者仍然可以通过无期限地读取某个文件值，从而实施拒绝服务攻击。

## 注入SOAP

**渗透测试步骤：**

(1) 轮流在每个参数中提交一个恶意XML结束标签，如`</foo>`。如果没有发生错误，那么输入可能没有插入到SOAP消息中，或者以某种方式被净化了。

(2) 如果出现错误，提交一对有效的起始与结束标签，如`<foo></foo>`。如果这对标签使错误消失，那么应用程序很可能易于受到攻击。

(3) 有时候，插入到XML格式消息中的数据随后以XML格式被读取并放回。如果修改的数据项在应用程序的响应中返回，看看提交任意XML内容是否会以相同的形式返回，或者已通过某种方式被规范化。轮流提交下面两个值：

    test<foo/>
    test<foo></foo>

如果发现其中一个值的返回结果为另一个值，或者只返回test，那么可以确信输入被插入到XML消息中。

(4) 如果HTTP请求中包含几个可放入SOAP消息的参数，尝试在一个参数中插入起始注释字符`<!--`，在另一个参数中插入结束注释字符`!-->`。然后，轮换在参数中插入这两个字符（因为不发知道参数的出现顺序）。这样做可能会把服务器SOAP消息的某个部分作为注释处理，从而改变应用程序的逻辑，或者形成一个可能造成信息泄露的不同错误条件。
